# azure-pipelines.yml

# 1. Trigger: Automatically start a new build on every push to the 'main' branch
trigger:
- main

# 2. Agent Pool: Use your configured self-hosted agent pool
pool:
  name: MyMavenLabPool 

# 3. Steps: The sequence of tasks to execute on the agent
steps:

# A. Maven Build, Compile, and Test Task
- task: Maven@3
  displayName: 'Maven: Clean, Package & Run Tests'
  inputs:
    # Path to the pom.xml file in your repository
    mavenPomFile: 'pom.xml'
    
    # Goals: Cleans previous build, compiles code, runs unit tests, and packages the application (e.g., creates a .jar or .war file)
    goals: 'clean package'
    
    # Java Version: Should match the JDK installed on your self-hosted agent
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.11' # Use '1.11' for Java 11 or '1.8' for Java 8, etc.

    # Test Reporting: Publish JUnit test results to Azure DevOps
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    mavenAuthenticateFeed: false

# B. Publish Artifacts Task
- task: PublishBuildArtifacts@1
  displayName: 'Publish Build Artifact: ECommerce-Drop'
  inputs:
    # The built artifact (JAR/WAR) is typically found in the target directory
    PathtoPublish: '$(System.DefaultWorkingDirectory)/**/target'
    
    # The name under which the artifact will be stored in Azure DevOps
    ArtifactName: 'ECommerce-Drop' 
    
    # Location: Publish the artifact to the Azure DevOps server storage
    publishLocation: 'Container'